<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Keuangan Pribadoy</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tailwindcss/browser@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Gaya CSS Kustom (jika diperlukan) */
        .transaksi-positif {
            color: #16a34a; /* Tailwind green-600 */
        }
        .transaksi-negatif {
            color: #dc2626; /* Tailwind red-600 */
        }

       
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            overflow-x: auto; /* Tambahkan scroll horizontal jika perlu */
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f0f0f0;
             /* Tambahkan animasi hover pada th */
            transition: background-color 0.3s ease;
        }
        th:hover {
            background-color: #e0e0e0; /* Warna latar belakang saat dihover */
        }

        td {
             /* Tambahkan animasi hover pada td */
            transition: background-color 0.3s ease;
        }
        td:hover {
            background-color: #f8f8f8;
        }
        .detail-transaksi {
            background-color: #e0f2fe; /* Tailwind blue-100 */
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
            border: 1px solid #b0e0fe; /* Tailwind blue-200 */
        }

        /* Media query untuk layar kecil */
        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            th, td {
                display: table-cell;
                vertical-align: top;
            }
            th {
                /*background-color: #f0f0f0;*/
            }
            /* Tambahkan gaya lain yang diperlukan untuk layar kecil */
            .grid-cols-4 {
                grid-template-columns: repeat(2, 1fr); /*ubah jadi 2 kolom*/
            }
            #section-tambah-transaksi .grid{
                display: flex;
                flex-direction: column;
            }
            #section-tambah-transaksi label{
                margin-top: 10px;
            }
            #section-filter-transaksi .grid{
                display: flex;
                flex-direction: column;
            }
            #section-filter-transaksi label{
                margin-top: 10px;
            }
        }

        /* Animasi untuk tombol */
        .animated-button {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Animasi untuk elemen yang muncul */
        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        .icon-animation {
            animation: spin 2s linear infinite;
            display: inline-block; /* Memastikan ikon diperlakukan seperti elemen inline */
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        /* Gaya untuk Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .pagination button {
            margin: 0 5px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: #fff;
            color: #333;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .pagination button:hover {
            background-color: #f0f0f0;
        }
        .pagination button.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        .pagination button:disabled {
            background-color: #ddd;
            color: #aaa;
            cursor: not-allowed;
            border-color: #ddd;
        }

        #chat-log p {
  margin-bottom: 8px;
}

        body.dark {
  background-color: #1f2937; /* gray-800 */
  color: #f3f4f6; /* gray-100 */
}

body.dark .bg-white {
  background-color: #374151; /* gray-700 */
}

body.dark .text-gray-600,
body.dark .text-gray-700,
body.dark .text-gray-800 {
  color: #d1d5db; /* gray-300 */
}

body.dark .bg-gray-100 {
  background-color: #4b5563; /* gray-600 */
}

body.dark .bg-indigo-100,
body.dark .bg-yellow-100,
body.dark .bg-purple-100,
body.dark .bg-green-100,
body.dark .bg-red-100 {
  background-color: #2d3748 !important; /* darker background */
}

body.dark .bg-gray-200 {
  background-color: #4b5563;
}

body.dark table {
  color: #f9fafb;
}


    </style>
</head>
<body class="bg-gray-100 font-inter">
    <div class="container mx-auto p-6 bg-white rounded-lg shadow-md mt-10 fade-in">
       <h1 class="text-4xl font-bold text-center text-indigo-700 mb-2 icon-animation">ðŸ’¸ Aplikasi CADAS</h1>
        <h3 class="text-xl font-medium text-center text-gray-600 mb-8">Catat Duit Adi Sudrajat</h3>

        <div id="section-login" class="bg-gray-100 rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4"><i class="fas fa-sign-in-alt mr-2"></i> Login</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="username" class="block text-gray-700 text-sm font-bold mb-2">Username:</label>
                    <input type="text" id="username" placeholder="Masukkan username" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                </div>
                <div>
                    <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Password:</label>
                    <input type="password" id="password" placeholder="Masukkan password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                </div>
            </div>
            <div class="mt-6">
                <button id="login-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline animated-button">
                    <i class="fas fa-lock mr-2"></i> Login
                </button>
            </div>
            <div id="error-message" class="text-red-500 text-xs italic mt-4" style="display: none;"></div>
             <p class="mt-4 text-gray-600 text-sm">
                <i class="fas fa-info-circle mr-1"></i>
                <b>Pengingat:</b> Selalu catat setiap transaksi Anda agar keuangan Anda terkontrol dengan baik.
            </p>
        </div>



        
        <div id="section-logout" class="bg-gray-100 rounded-lg p-6 mb-8" style="display: none;">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4"><i class="fas fa-sign-out-alt mr-2"></i> Logout</h2>
            <p class="text-gray-800 mb-4">Anda telah login. Klik tombol di bawah untuk logout.</p>
            <button id="logout-button" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline animated-button">
                <i class="fas fa-door-open mr-2"></i> Logout
            </button>
             <p class="mt-4 text-gray-600 text-sm">
                <i class="fas fa-check-circle mr-1"></i>
                <b>Motivasi:</b> "Setiap pengeluaran yang dicatat adalah langkah menuju kebebasan finansial."
            </p>






<div class="flex justify-end mb-4">
  <button id="toggle-dark-mode" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700 transition">
    ðŸŒ™ Dark Mode
  </button>
</div>





<div class="text-right">
  <a href="https://portofolioadi.vercel.app" target="_blank">
       <p class="text-gray-800 mb-4">Silakan kunjungi website potofolio Anda</p>
    <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline animated-button">
      WEBSITE PORTOFOLIO ANDA
    </button>
  </a>
</div>
            
        </div>

        <div id="section-saldo" class="bg-white rounded-lg p-4 mb-6" style="display: none;">
            <h2 class="text-xl font-semibold text-indigo-700 mb-2"><i class="fas fa-wallet mr-2"></i> Saldo Anda</h2>
            <p id="total-saldo" class="text-2xl font-bold text-gray-800">Rp 0</p>
             <p class="mt-2 text-gray-600 text-sm">
                <i class="fas fa-money-check-alt mr-1"></i>
                <b>Motivasi:</b> "Saldo yang bertambah adalah hasil dari kedisiplinan dan perencanaan yang baik."
            </p>
        </div>

        <div id="section-tambah-transaksi" class="bg-white rounded-lg p-6 mb-8" style="display: none;">
            <h2 class="text-2xl font-semibold text-yellow-700 mb-4"><i class="fas fa-plus-circle mr-2"></i> Tambah Transaksi</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <label for="tanggal" class="block text-gray-700 text-sm font-bold mb-2">Tanggal:</label>
                <input type="date" id="tanggal" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />

                <label for="jenis" class="block text-gray-700 text-sm font-bold mb-2">Jenis:</label>
                <select id="jenis" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="pendapatan">Pendapatan</option>
                    <option value="pengeluaran">Pengeluaran</option>
                </select>

                <label for="kategori" class="block text-gray-700 text-sm font-bold mb-2">Kategori:</label>
                <input type="text" id="kategori" placeholder="Makanan, Transport..." class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />

                <label for="jumlah" class="block text-gray-700 text-sm font-bold mb-2">Jumlah:</label>
                <input type="number" id="jumlah" placeholder="Masukkan jumlah" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
            </div>
            <div class="mt-6">
                <button id="tambah-transaksi" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline animated-button">
                    <i class="fas fa-plus mr-2"></i> Tambah Transaksi
                </button>
            </div>
             <p class="mt-4 text-gray-600 text-sm">
                <i class="fas fa-lightbulb mr-1"></i>
                <b>Tips:</b> Selalu kategorikan transaksi Anda untuk analisis yang lebih baik.
            </p>
        </div>

        <div id="section-filter-transaksi" class="bg-white rounded-lg p-6 mb-8" style="display: none;">
            <h2 class="text-2xl font-semibold text-purple-700 mb-4"><i class="fas fa-filter mr-2"></i> Filter Transaksi</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="filter-bulan" class="block text-gray-700 text-sm font-bold mb-2">Filter Bulan:</label>
                    <select id="filter-bulan" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="">Semua Bulan</option>
                        <option value="0">Januari</option>
                        <option value="1">Februari</option>
                        <option value="2">Maret</option>
                        <option value="3">April</option>
                        <option value="4">Mei</option>
                        <option value="5">Juni</option>
                        <option value="6">Juli</option>
                        <option value="7">Agustus</option>
                        <option value="8">September</option>
                        <option value="9">Oktober</option>
                        <option value="10">November</option>
                        <option value="11">Desember</option>
                    </select>
                </div>
                <div>
                    <label for="filter-tahun" class="block text-gray-700 text-sm font-bold mb-2">Filter Tahun:</label>
                    <select id="filter-tahun" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>
                <div>
                    <label for="filter-kategori" class="block text-gray-700 text-sm font-bold mb-2">Filter Kategori:</label>
                    <input type="text" id="filter-kategori" placeholder="Cari Kategori" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" />
                </div>
            </div>
             <p class="mt-4 text-gray-600 text-sm">
                <i class="fas fa-search mr-1"></i>
                <b>Pengingat:</b> Gunakan filter untuk melihat riwayat transaksi Anda dengan lebih mudah.
            </p>
        </div>

        <div id="section-daftar-transaksi" class="bg-white rounded-lg p-6 mb-8" style="display: none;">
            <h2 class="text-2xl font-semibold text-green-700 mb-4"><i class="fas fa-list-ul mr-2"></i> Daftar Transaksi</h2>
            <div class="overflow-x-auto">
                <table id="daftar-transaksi" class="min-w-full leading-normal shadow-md rounded-lg overflow-hidden">
                    <thead class="bg-gray-200 text-gray-700">
                        <tr>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold uppercase tracking-wider">Tanggal</th>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold uppercase tracking-wider">Jenis</th>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold uppercase tracking-wider">Kategori</th>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-right text-xs font-semibold uppercase tracking-wider">Jumlah</th>
                            <th class="px-5 py-3 border-b-2 border-gray-200 text-left text-xs font-semibold uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white">
                        <tr>
                            <td colspan="5" class="px-5 py-5 border-b border-gray-200 text-sm">Tidak ada transaksi.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="pagination">
    <button id="prev-page" disabled>Previous</button>
    <button id="next-page">Next</button>
</div>


            <p class="mt-4 text-gray-600 text-sm">
                <i class="fas fa-history mr-1"></i>
                <b>Motivasi:</b> "Setiap transaksi adalah bagian dari cerita keuangan Anda. Catat dengan baik!"
            </p>

        <div id="section-summary" class="bg-white rounded-lg p-6 mb-8" style="display: none;">
            <h2 class="text-2xl font-semibold text-red-700 mb-4"><i class="fas fa-chart-pie mr-2"></i> Ringkasan</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <h3 class="text-lg font-semibold text-gray-700">Total Pendapatan:</h3>
                    <p id="total-pendapatan" class="text-xl font-bold text-green-600">Rp 0</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-700">Total Pengeluaran:</h3>
                    <p id="total-pengeluaran" class="text-xl font-bold text-red-600">Rp 0</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-700">Saldo Akhir:</h3>
                    <p id="saldo-akhir" class="text-xl font-bold text-blue-600">Rp 0</p>
                </div>
            </div>

            <div id="section-chatbot" class="bg-white rounded-lg p-6 mb-8 shadow-md">
  <h2 class="text-2xl font-semibold text-gray-800 mb-4"><i class="fas fa-robot mr-2"></i> CADASBot</h2>
  <div id="chat-log" class="bg-gray-100 rounded p-4 h-60 overflow-y-auto mb-4 text-sm"></div>
  <input type="text" id="chat-input" placeholder="Tanya sesuatu seperti: 'pengeluaran bulan ini'" class="w-full p-2 border rounded shadow focus:outline-none focus:ring" />
</div>
            <p class="mt-4 text-gray-600 text-sm">
                <i class="fas fa-chart-line mr-1"></i>
                <b>Motivasi:</b> "Ringkasan ini membantu Anda melihat gambaran besar keuangan Anda."
            </p>
        </div>


<div id="kalkulator-tabungan" class="bg-white rounded-lg p-6 mb-8">
  <h2 class="text-2xl font-semibold text-indigo-600 mb-4">
    <i class="fas fa-calculator mr-2"></i> Kalkulator Tabungan
  </h2>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
    <input type="number" id="target-nominal" placeholder="Target tabungan (Rp)" class="border p-2 rounded" />
    <input type="number" id="jumlah-nabung" placeholder="Jumlah per nabung" class="border p-2 rounded" />
    <select id="frekuensi-nabung" class="border p-2 rounded">
      <option value="hari">Harian</option>
      <option value="minggu">Mingguan</option>
      <option value="bulan">Bulanan</option>
    </select>
  </div>
  <button onclick="hitungTabungan()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
    Hitung
  </button>
  <p id="hasil-kalkulasi" class="mt-4 text-gray-800 text-sm"></p>
</div>


            
        <div class="text-center mt-6">
            <button id="cetak-pdf" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline animated-button">
                <i class="fas fa-print mr-2"></i> Cetak
            </button>
             <p class="mt-4 text-gray-600 text-sm">
                <i class="fas fa-file-pdf mr-1"></i>
                <b>Pengingat:</b> Cetak laporan untuk dokumentasi fisik dan perencanaan di masa mendatang.
            </p>
        </div>
    </div>
 <footer class="copyright">
        &copy; 2024 Adi Sudrajat. All rights reserved.
    </footer>

    <script>
        // Data transaksi (sementara, akan disimpan di localStorage setelah login)
        let transaksi = [];
        let isLoggedIn = false;
        let username = "";
        let selectedTransaksiId = null;
    
        const recordsPerPage = 5; // Jumlah transaksi per halaman

        // Mendapatkan elemen-elemen HTML
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const loginSection = document.getElementById('section-login');
        const logoutSection = document.getElementById('section-logout');
        const saldoSection = document.getElementById('section-saldo');
        const tambahTransaksiSection = document.getElementById('section-tambah-transaksi');
        const filterTransaksiSection = document.getElementById('section-filter-transaksi');
        const daftarTransaksiTable = document.getElementById('daftar-transaksi');
        const summarySection = document.getElementById('section-summary');
        const cetPdfButton = document.getElementById('cetak-pdf');
        const prevPageButton = document.getElementById('prev-page');
        const nextPageButton = document.getElementById('next-page');

        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const errorMessage = document.getElementById('error-message');

        const tanggalInput = document.getElementById('tanggal');
        const jenisInput = document.getElementById('jenis');
        const kategoriInput = document.getElementById('kategori');
        const jumlahInput = document.getElementById('jumlah');
        const tambahTransaksiButton = document.getElementById('tambah-transaksi');

        const totalSaldoElement = document.getElementById('total-saldo');
        const totalPendapatanElement = document.getElementById('total-pendapatan');
        const totalPengeluaranElement = document.getElementById('total-pengeluaran');
        const saldoAkhirElement = document.getElementById('saldo-akhir');

        const filterBulanInput = document.getElementById('filter-bulan');
        const filterTahunInput = document.getElementById('filter-tahun');
        const filterKategoriInput = document.getElementById('filter-kategori');

        const detailTransaksiDiv = document.getElementById('detail-transaksi');
        const detailTanggalElement = document.getElementById('detail-tanggal');
        const detailJenisElement = document.getElementById('detail-jenis');
        const detailKategoriElement = document.getElementById('detail-kategori');
        const detailJumlahElement = document.getElementById('detail-jumlah');
        const hapusTransaksiButton = document.getElementById('hapus-transaksi');

        // Fungsi untuk menampilkan atau menyembunyikan bagian-bagian aplikasi
        function toggleSections() {
            if (isLoggedIn) {
                loginSection.style.display = 'none';
                logoutSection.style.display = 'block';
                saldoSection.style.display = 'block';
                tambahTransaksiSection.style.display = 'block';
                filterTransaksiSection.style.display = 'block';
                daftarTransaksiTable.parentElement.parentElement.style.display = 'block';
                summarySection.style.display = 'block';
                cetPdfButton.parentElement.style.display = 'block';
                prevPageButton.parentElement.style.display = 'flex'; //memastikan tombol navigasi selalu flex
            } else {
                loginSection.style.display = 'block';
                logoutSection.style.display = 'none';
                saldoSection.style.display = 'none';
                tambahTransaksiSection.style.display = 'none';
                filterTransaksiSection.style.display = 'none';
                daftarTransaksiTable.parentElement.parentElement.style.display = 'none';
                summarySection.style.display = 'none';
                cetPdfButton.parentElement.style.display = 'none';
                prevPageButton.parentElement.style.display = 'none';
            }
        }

        // Event listener untuk tombol login
        loginButton.addEventListener('click', () => {
            const enteredUsername = usernameInput.value;
            const enteredPassword = passwordInput.value;

            if (enteredUsername === 'adi' && enteredPassword === 'adi') {
                isLoggedIn = true;
                username = enteredUsername;
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('username', username);
                // Load transaksi from localStorage
                const storedTransaksi = localStorage.getItem('transaksi-' + username);
                if (storedTransaksi) {
                    transaksi = JSON.parse(storedTransaksi);
                }
                toggleSections();
                renderTransaksi();
                Swal.fire({
                    icon: 'success',
                    title: 'Berhasil!',
                    text: 'Anda berhasil login.',
                    timer: 1500,
                    showConfirmButton: false,
                });
            } else {
                errorMessage.textContent = 'Username atau password salah.';
                errorMessage.style.display = 'block';
                Swal.fire({
                    icon: 'error',
                    title: 'Gagal!',
                    text: 'Username atau password salah.',
                });
            }
            usernameInput.value = '';
            passwordInput.value = '';
        });

        // Event listener untuk tombol logout
        logoutButton.addEventListener('click', () => {
            isLoggedIn = false;
            username = "";
            localStorage.setItem('isLoggedIn', 'false');
            localStorage.removeItem('username');
             // Clear transaksi from localStorage
            localStorage.removeItem('transaksi-' + username);
            transaksi = [];
            toggleSections();
            renderTransaksi();
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Anda berhasil logout.',
                timer: 1500,
                showConfirmButton: false,
            });
        });

        // Fungsi untuk menambahkan transaksi baru
        function tambahTransaksi() {
            const tanggal = tanggalInput.value;
            const jenis = jenisInput.value;
            const kategori = kategoriInput.value;
            const jumlah = parseFloat(jumlahInput.value);

            if (!tanggal || !jenis || !kategori || isNaN(jumlah)) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Harap isi semua field dengan benar.',
                });
                return;
            }

            const transaksiBaru = {
                id: Date.now(), // Tambahkan ID unik
                tanggal,
                jenis,
                kategori,
                jumlah,
                timestamp: new Date().getTime()
            };

            transaksi.push(transaksiBaru);
let alertSudahMuncul = false;

if (jenis === 'pengeluaran' && jumlah > 500000) {
    alertSudahMuncul = true;
    Swal.fire({
        icon: 'warning',
        title: 'Pengeluaran Besar!',
        html: `Pengeluaran untuk kategori <strong>${kategori}</strong> sebesar <strong>Rp ${jumlah.toLocaleString('id-ID')}</strong> melebihi Rp 500.000.`,
        confirmButtonColor: '#d97706'
    });
}

            localStorage.setItem('transaksi-' + username, JSON.stringify(transaksi)); // Save transaksi
            renderTransaksi(); // Panggil renderTransaksi setelah menambah transaksi

            tanggalInput.value = '';
            jenisInput.value = 'pendapatan';
            kategoriInput.value = '';
            jumlahInput.value = '';

            
if (!alertSudahMuncul) {
    Swal.fire({
        icon: 'success',
        title: 'Berhasil!',
        text: 'Transaksi Anda telah ditambahkan.',
        timer: 1500,
        showConfirmButton: false,
    });
}

        }



        // Fungsi untuk menampilkan detail transaksi
        function tampilkanDetailTransaksi(id) {
            const transaksiDetail = transaksi.find(t => t.id === id);
            if (transaksiDetail) {
                selectedTransaksiId = id;

                const tanggalFormatted = new Date(transaksiDetail.tanggal).toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });

                Swal.fire({
                    title: 'Detail Transaksi',
                    html: `
                        <p><strong>Tanggal:</strong> ${tanggalFormatted}</p>
                        <p><strong>Jenis:</strong> ${transaksiDetail.jenis}</p>
                        <p><strong>Kategori:</strong> ${transaksiDetail.kategori}</p>
                        <p><strong>Jumlah:</strong> Rp ${transaksiDetail.jumlah.toLocaleString('id-ID')}</p>
                    `,
                    icon: 'info',
                    showCancelButton: true,
                    confirmButtonText: 'Hapus',
                    cancelButtonText: 'Tutup',
                    confirmButtonColor: '#e11d48',
                    cancelButtonColor: '#3b82f6'
                }).then((result) => {
                    if (result.isConfirmed) {
                        hapusTransaksiById(selectedTransaksiId);
                    }
                });
            }
        }

        // Event listener untuk tombol hapus transaksi
        function hapusTransaksiById(id) {
            transaksi = transaksi.filter(t => t.id !== id);
            localStorage.setItem('transaksi-' + username, JSON.stringify(transaksi));
            renderTransaksi();
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Transaksi dihapus.',
                timer: 1500,
                showConfirmButton: false
            });
        }


        // Fungsi untuk menampilkan daftar transaksi dengan pagination
        function renderTransaksi() {
            const transaksiListBody = daftarTransaksiTable.querySelector('tbody');
            transaksiListBody.innerHTML = '';

            const filterBulan = filterBulanInput.value;
            const filterTahun = filterTahunInput.value;
            const filterKategori = filterKategoriInput.value.toLowerCase();

            let totalPendapatan = 0;
            let totalPengeluaran = 0;
            let saldoAkhir = 0;

            const transaksiYangDifilter = transaksi.filter(transaksi =>{
                const tanggalTransaksi = new Date(transaksi.tanggal);
                const bulanTransaksi = tanggalTransaksi.getMonth().toString();
                const tahunTransaksi = tanggalTransaksi.getFullYear().toString();
                const kategoriTransaksi = transaksi.kategori.toLowerCase();

                const cocokBulan = !filterBulan || bulanTransaksi === filterBulan;
                const cocokTahun = !filterTahun || tahunTransaksi === filterTahun; // Tambahkan ini
                const cocokKategori = !filterKategori || kategoriTransaksi.includes(filterKategori);

                return cocokBulan && cocokTahun && cocokKategori;
            }).sort((a, b) => {
                // Urutkan berdasarkan timestamp, transaksi terbaru di atas
                return new Date(b.tanggal).getTime() - new Date(a.tanggal).getTime();
            });

           const transaksiHalamanIni = transaksiYangDifilter;


            if (transaksiYangDifilter.length === 0) {
                transaksiListBody.innerHTML = `<tr><td colspan="5" class="px-5 py-5 border-b border-gray-200 text-sm text-gray-500">Tidak ada transaksi yang sesuai dengan filter.</td></tr>`;
                prevPageButton.disabled = true;
                nextPageButton.disabled = true;
            } else {
                transaksiHalamanIni.forEach(transaksi => {
                    const row = document.createElement('tr');
                    const tanggalFormatted = new Date(transaksi.tanggal).toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });

                    row.innerHTML = `
                        <td class="px-5 py-5 border-b border-gray-200 text-sm"><span class="font-italic text-gray-800">${tanggalFormatted}</span></td>
                        <td class="px-5 py-5 border-b border-gray-200 text-sm"><span class="font-semibold ${transaksi.jenis === 'pendapatan' ? 'transaksi-positif': 'transaksi-negatif'}">${transaksi.jenis}</span></td>
                        <td class="px-5 py-5 border-b border-gray-200 text-sm"><span class="font-oblique font-sans text-purple-600">${transaksi.kategori}</span></td>
                       <td class="px-5 py-5 border-b border-gray-200 text-sm text-right text-blue-600">Rp ${transaksi.jumlah.toLocaleString('id-ID')}</td>
                        <td class="px-5 py-5 border-b border-gray-200 text-sm">
                            <button class="lihat-detail bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline text-xs" data-id="${transaksi.id}">
                                <i class="fas fa-info-circle"></i> Detail
                            </button>
                        </td>
                    `;
                    transaksiListBody.appendChild(row);

                    if (transaksi.jenis === 'pendapatan') {
                        totalPendapatan += transaksi.jumlah;
                    } else {
                        totalPengeluaran += transaksi.jumlah;
                    }
                });

                // Tambahkan event listener untuk tombol "Detail" setelah ditambahkan ke DOM
                const detailButtons = daftarTransaksiTable.querySelectorAll('.lihat-detail');
                detailButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const id = parseInt(button.getAttribute('data-id'));
                        tampilkanDetailTransaksi(id);
                    });
                });

                
            }

            saldoAkhir = totalPendapatan - totalPengeluaran;

            totalSaldoElement.textContent = `Rp ${saldoAkhir.toLocaleString('id-ID')}`;
            totalPendapatanElement.textContent = `Rp ${totalPendapatan.toLocaleString('id-ID')}`;
            totalPengeluaranElement.textContent = `Rp ${totalPengeluaran.toLocaleString('id-ID')}`;
            saldoAkhirElement.textContent = `Rp ${saldoAkhir.toLocaleString('id-ID')}`;
        }

        // Fungsi untuk mencetak laporan
        function cetakLaporan() {
            // Menyaring transaksi berdasarkan filter
            const transaksiYangDifilter = transaksi.filter(transaksi => {
                const tanggalTransaksi = new Date(transaksi.tanggal);
                const bulanTransaksi = tanggalTransaksi.getMonth().toString();
                const tahunTransaksi = tanggalTransaksi.getFullYear().toString();
                const kategoriTransaksi = transaksi.kategori.toLowerCase();
                const filterBulan = filterBulanInput.value;
                const filterTahun = filterTahunInput.value;
                const filterKategori = filterKategoriInput.value.toLowerCase();

                const cocokBulan = !filterBulan || bulanTransaksi === filterBulan;
                const cocokTahun = !filterTahun || tahunTransaksi === tahunTransaksi;
                const cocokKategori = !filterKategori || kategoriTransaksi.includes(filterKategori);

                return cocokBulan && cocokTahun && cocokKategori;
            }).sort((a, b) =>  new Date(b.tanggal).getTime() - new Date(a.tanggal).getTime());

            // Membuat string HTML untuk tabel
            let tableHTML = `
                <h1 style="text-align:center; font-size: 18px; margin-bottom: 20px;">Laporan Keuangan Pribadi</h1>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <thead style="background-color: #f0f0f0;">
                        <tr>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Tanggal</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Jenis</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Kategori</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">Jumlah</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            if (transaksiYangDifilter.length === 0) {
                tableHTML += `
                    <tr>
                        <td colspan="4" style="border: 1px solid #ddd; padding: 8px; text-align: center;">Tidak ada transaksi yang sesuai dengan filter.</td>
                    </tr>
                `;
            } else {
                transaksiYangDifilter.forEach(transaksi => {
                    const tanggalFormatted = new Date(transaksi.tanggal).toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                    tableHTML += `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">${tanggalFormatted}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">${transaksi.jenis}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">${transaksi.kategori}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">Rp ${transaksi.jumlah.toLocaleString('id-ID')}</td>
                        </tr>
                    `;
                });
            }

            tableHTML += `
                    </tbody>
                </table>
                <div style="margin-top: 20px; font-size: 14px;">
                    <p><strong>Total Pendapatan:</strong> <span style="color: green;">${totalPendapatanElement.textContent}</span></p>
                    <p><strong>Total Pengeluaran:</strong> <span style="color: red;">${totalPengeluaranElement.textContent}</span></p>
                    <p><strong>Saldo Akhir:</strong> <span style="color: blue;">${saldoAkhirElement.textContent}</span></p>
                </div>
            `;

            // Membuka jendela baru untuk mencetak
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.open();
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>Laporan Keuangan</title>
                            <style>
                                body {
                                    font-family: 'Arial', sans-serif;
                                    margin: 0;
                                    padding: 0;
                                }
                                table {
                                    width: 100%;
                                    border-collapse: collapse;
                                }
                                th, td {
                                    border: 1px solid #ddd;
                                    padding: 8px;
                                    text-align: left;
                                }
                                th {
                                    background-color: #f0f0f0;
                                }
                                .transaksi-positif {
                                    color: #16a34a; /* Tailwind green-600 */
                                }
                                .transaksi-negatif {
                                    color: #dc2626; /* Tailwind red-600 */
                                }
                            </style>
                        </head>
                        <body>${tableHTML}</body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            } else {
                alert('Gagal membuka jendela cetak. Pastikan browser Anda mengizinkan pop-up.');
            }
        }

        // Inisialisasi aplikasi
        if (localStorage.getItem('isLoggedIn') === 'true') {
            isLoggedIn = true;
            username = localStorage.getItem('username');
            const storedTransaksi = localStorage.getItem('transaksi-' + username);
            if (storedTransaksi) {
                transaksi = JSON.parse(storedTransaksi);
            }
            toggleSections();
            renderTransaksi();
        } else {
            toggleSections();
        }

        // Generate tahun options
        const tahunSelect = document.getElementById('filter-tahun');
        const tahunTerakhir = new Date().getFullYear();
        for (let i = tahunTerakhir; i >= 2020; i--) { // Misalnya, mulai dari tahun 2020
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            tahunSelect.appendChild(option);
        }

        // Event listeners
        tambahTransaksiButton.addEventListener('click', tambahTransaksi);
        filterBulanInput.addEventListener('change', () => { currentPage = 1; renderTransaksi();});
        filterTahunInput.addEventListener('change', () => { currentPage = 1; renderTransaksi();});
        filterKategoriInput.addEventListener('input', () => { currentPage = 1; renderTransaksi();});
        document.getElementById('cetak-pdf').addEventListener('click', async () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            let y = 10;
            doc.setFontSize(14);
            doc.text('Laporan Keuangan Pribadi', 105, y, { align: 'center' });

            const filtered = transaksi.filter(transaksi => {
                const tanggal = new Date(transaksi.tanggal);
                const filterBulan = filterBulanInput.value;
                const filterTahun = filterTahunInput.value;
                const filterKategori = filterKategoriInput.value.toLowerCase();

                return (!filterBulan || tanggal.getMonth().toString() === filterBulan) &&
                    (!filterTahun || tanggal.getFullYear().toString() === filterTahun) &&
                    (!filterKategori || transaksi.kategori.toLowerCase().includes(filterKategori));
            });

            if (filtered.length === 0) {
                Swal.fire({
                    icon: 'info',
                    title: 'Tidak Ada Data',
                    text: 'Transaksi yang cocok tidak ditemukan.',
                });
                return;
            }

            y += 10;
            doc.setFontSize(10);
            doc.text('Tanggal      Jenis        Kategori            Jumlah', 10, y);
            y += 5;
            doc.line(10, y, 200, y);

            filtered.forEach(t => {
                y += 7;
                const tanggal = new Date(t.tanggal).toLocaleDateString('id-ID');
                const baris = `${tanggal.padEnd(12)} ${t.jenis.padEnd(10)} ${t.kategori.padEnd(18)} Rp ${t.jumlah.toLocaleString('id-ID')}`;
                if (y > 270) {
                    doc.addPage();
                    y = 10;
                }
                doc.text(baris, 10, y);
            });

            y += 10;
            doc.text(`Total Pendapatan: ${totalPendapatanElement.textContent}`, 10, y += 7);
            doc.text(`Total Pengeluaran: ${totalPengeluaranElement.textContent}`, 10, y += 7);
            doc.text(`Saldo Akhir: ${saldoAkhirElement.textContent}`, 10, y += 7);

            doc.save(`laporan-keuangan-${Date.now()}.pdf`);
        });

        // Event listener untuk tombol previous page
async function tanyaKeBot(pertanyaan) {
  try {
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ input: pertanyaan })
    });

    const data = await res.json();
    return data.result;
  } catch (error) {
    return `âŒ Terjadi kesalahan: ${error.message}`;
  }
}



        
        // Event listener untuk tombol next page
    document.getElementById('chat-input').addEventListener('keypress', function (e) {
  if (e.key === 'Enter') {
    const input = this.value.trim().toLowerCase();
    const log = document.getElementById('chat-log');

    const addToLog = (from, msg) => {
      log.innerHTML += `<p><strong>${from}:</strong> ${msg}</p>`;
      log.scrollTop = log.scrollHeight;
    };

    if (!input) return;
    addToLog('Kamu', input);
    this.value = '';

    if (input.includes('saldo akhir')) {
      const pendapatan = transaksi.filter(t => t.jenis === 'pendapatan').reduce((a, b) => a + b.jumlah, 0);
      const pengeluaran = transaksi.filter(t => t.jenis === 'pengeluaran').reduce((a, b) => a + b.jumlah, 0);
      const jawaban = `Saldo akhir saat ini adalah <b>Rp ${(pendapatan - pengeluaran).toLocaleString('id-ID')}</b>`;
      setTimeout(() => addToLog('CADASBot ðŸ¤–', jawaban), 400);
      return;
    }

    else if (input.includes('pengeluaran bulan ini')) {
      const now = new Date();
      const total = transaksi.filter(t => t.jenis === 'pengeluaran' && new Date(t.tanggal).getMonth() === now.getMonth() && new Date(t.tanggal).getFullYear() === now.getFullYear())
        .reduce((sum, t) => sum + t.jumlah, 0);
      const jawaban = `Total pengeluaran bulan ini: <b>Rp ${total.toLocaleString('id-ID')}</b>`;
      setTimeout(() => addToLog('CADASBot ðŸ¤–', jawaban), 400);
      return;
    }

    else if (input.includes('pendapatan bulan ini')) {
      const now = new Date();
      const total = transaksi.filter(t => t.jenis === 'pendapatan' && new Date(t.tanggal).getMonth() === now.getMonth() && new Date(t.tanggal).getFullYear() === now.getFullYear())
        .reduce((sum, t) => sum + t.jumlah, 0);
      const jawaban = `Total pendapatan bulan ini: <b>Rp ${total.toLocaleString('id-ID')}</b>`;
      setTimeout(() => addToLog('CADASBot ðŸ¤–', jawaban), 400);
      return;
    }

    else if (input.includes('pengeluaran hari ini')) {
      const today = new Date().toISOString().split('T')[0];
      const total = transaksi.filter(t => t.jenis === 'pengeluaran' && t.tanggal === today)
        .reduce((sum, t) => sum + t.jumlah, 0);
      const jawaban = `Total pengeluaran hari ini: <b>Rp ${total.toLocaleString('id-ID')}</b>`;
      setTimeout(() => addToLog('CADASBot ðŸ¤–', jawaban), 400);
      return;
    }

    else if (input.includes('transaksi terakhir')) {
      const terakhir = [...transaksi].sort((a, b) => b.timestamp - a.timestamp)[0];
      let jawaban;
      if (terakhir) {
        const tanggal = new Date(terakhir.tanggal).toLocaleDateString('id-ID');
        jawaban = `Transaksi terakhir kamu:<br>ðŸ“… <b>${tanggal}</b><br>ðŸ“‚ <b>${terakhir.kategori}</b><br>ðŸ’° <b>Rp ${terakhir.jumlah.toLocaleString('id-ID')}</b>`;
      } else {
        jawaban = 'Belum ada transaksi yang dicatat.';
      }
      setTimeout(() => addToLog('CADASBot ðŸ¤–', jawaban), 400);
      return;
    }

    else if (input.includes('berapa kali') && input.includes('kopi')) {
      const count = transaksi.filter(t => t.kategori.toLowerCase().includes('kopi')).length;
      const jawaban = `Kamu mencatat transaksi "kopi" sebanyak <b>${count}</b> kali. â˜•`;
      setTimeout(() => addToLog('CADASBot ðŸ¤–', jawaban), 400);
      return;
    }
        

    else if (input.includes('halo') || input.includes('hai')) {
      const jawaban = 'Halo juga! ðŸ‘‹ Ada yang bisa aku bantu tentang keuanganmu hari ini?';
      setTimeout(() => addToLog('CADASBot ðŸ¤–', jawaban), 400);
      return;
    }


        
    else if (input.includes('kontol') || input.includes('memek')) {
      const jawaban = 'ari maneh, ulah kasar anjing';
      setTimeout(() => addToLog('CADASBot ðŸ¤–', jawaban), 400);
      return;
    }

    // ðŸ”¥ Ini buat Hugging Face
    else {
      addToLog('CADASBot ðŸ¤–', "Sebentar ya, aku tanya ke AI dulu...");
      tanyaKeBot(input).then(jawaban => {
        addToLog('CADASBot ðŸ¤–', jawaban);
      });
      return;
    }
  }
});

        const toggleDarkBtn = document.getElementById('toggle-dark-mode');
toggleDarkBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    localStorage.setItem('darkMode', document.body.classList.contains('dark'));
});

// Inisialisasi dark mode saat halaman dimuat
window.addEventListener('DOMContentLoaded', () => {
    const isDark = localStorage.getItem('darkMode') === 'true';
    if (isDark) {
        document.body.classList.add('dark');
    }
});

        function hitungTabungan() {
  const target = parseFloat(document.getElementById('target-nominal').value);
  const jumlah = parseFloat(document.getElementById('jumlah-nabung').value);
  const frekuensi = document.getElementById('frekuensi-nabung').value;
  const hasil = document.getElementById('hasil-kalkulasi');

  if (isNaN(target) || isNaN(jumlah) || jumlah <= 0) {
    hasil.innerHTML = 'âŒ Harap isi nilai target dan jumlah tabungan dengan benar.';
    return;
  }

  const waktu = Math.ceil(target / jumlah);
  const hariKeDepan = frekuensi === 'hari' ? waktu : frekuensi === 'minggu' ? waktu * 7 : waktu * 30;
  const tanggalSelesai = new Date();
  tanggalSelesai.setDate(tanggalSelesai.getDate() + hariKeDepan);

  const tanggalStr = tanggalSelesai.toLocaleDateString('id-ID', {
    day: 'numeric',
    month: 'long',
    year: 'numeric'
  });

  hasil.innerHTML = `
    Dengan menabung <b>Rp ${jumlah.toLocaleString('id-ID')}</b> per <b>${frekuensi}</b>,<br>
    kamu bisa mencapai target <b>Rp ${target.toLocaleString('id-ID')}</b> dalam <b>${waktu}</b> ${frekuensi}.<br>
    Estimasi tercapai pada: <b>${tanggalStr}</b>.
  `;
}


    </script>
</body>
</html>
