import React, { useState, useEffect, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Calendar } from '@/components/ui/calendar';
import {
    Card,
    CardContent,
    CardDescription,
    CardFooter,
    CardHeader,
    CardTitle,
} from '@/components/ui/card';
import {
    Select,
    SelectContent,
    SelectItem,
    SelectTrigger,
    SelectValue,
} from '@/components/ui/select';
import { Textarea } from '@/components/ui/textarea';
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle,
    DialogTrigger,
} from '@/components/ui/dialog';
import { format, subMonths, addMonths } from 'date-fns';
import { CalendarIcon, Plus, Trash2, Edit, Save, LogOut, User, CheckCircle, AlertTriangle } from 'lucide-react';
import { cn } from '@/lib/utils';
import { motion, AnimatePresence } from 'framer-motion';

// Konfigurasi Firebase
const firebaseConfig = {
    apiKey: "AIzaSyALFES7pZAlW5bpMiRSVQBYmsulFwgaYo8",
    authDomain: "keuanganbaru-4f700.firebaseapp.com",
    projectId: "keuanganbaru-4f700",
    storageBucket: "keuanganbaru-4f700.firebasestorage.app",
    messagingSenderId: "587188609202",
    appId: "1:587188609202:web:8317e16e4c68a9e97be9ab",
    measurementId: "G-HJ1K9FM286"
};

// Inisialisasi Firebase (pastikan hanya dipanggil sekali)
let firebaseApp;
let auth;
let db;
try {
    firebaseApp = require("firebase/app").initializeApp(firebaseConfig);
    auth = require("firebase/auth").getAuth(firebaseApp);
    db = require("firebase/firestore").getFirestore(firebaseApp);
} catch (error) {
    // Handle jika Firebase sudah diinisialisasi
    if (error.code !== 'app/duplicate-app') {
        console.error("Error initializing Firebase:", error);
    }
}

// Tipe Data
interface Transaction {
    id: string;
    date: Date;
    type: 'income' | 'expense';
    category: string;
    amount: number;
    description: string;
}

interface UserProfile {
    uid: string;
    email: string;
    displayName: string;
}

// Konstanta Kategori
const CATEGORIES = [
    'Makanan',
    'Transportasi',
    'Tagihan',
    'Hiburan',
    'Gaji',
    'Investasi',
    'Lain-lain',
];

// Helper Functions
const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
    }).format(amount);
};

const getMonthName = (date: Date) => {
    return date.toLocaleDateString('id-ID', { month: 'long' });
};

// Animation Variants
const transactionVariants = {
    hidden: { opacity: 0, y: -10 },
    visible: { opacity: 1, y: 0, transition: { duration: 0.3 } },
    exit: { opacity: 0, y: 10, transition: { duration: 0.2 } },
};

// Components
const TransactionCard = ({
    transaction,
    onDelete,
    onEdit,
}: {
    transaction: Transaction;
    onDelete: (id: string) => void;
    onEdit: (id: string) => void;
}) => {
    return (
        <motion.div
            variants={transactionVariants}
            initial="hidden"
            animate="visible"
            exit="exit"
            className="bg-white/5 backdrop-blur-md rounded-lg p-4 shadow-md border border-white/10"
        >
            <div className="flex justify-between items-center">
                <div className="flex items-center gap-4">
                    <div
                        className={cn(
                            'w-10 h-10 rounded-full flex items-center justify-center',
                            transaction.type === 'income'
                                ? 'bg-green-500/20 text-green-400'
                                : 'bg-red-500/20 text-red-400',
                        )}
                    >
                        {transaction.type === 'income' ? (
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                className="h-6 w-6"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    strokeLinecap="round"
                                    strokeLinejoin="round"
                                    strokeWidth={2}
                                    d="M13 9v6m-3-3h6m1 1V19a2 2 0 01-2 2H6a2 2 0 01-2-2v-7m13-4v-3c0-1.108-.892-2-2-2H9a2 2 0 00-2 2v3m7 0h1.8a2 2 0 002-2v-5a2 2 0 00-2-2H8.2a2 2 0 00-2 2v5a2 2 0 002 2H9"
                                />
                            </svg>
                        ) : (
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                className="h-6 w-6"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    strokeLinecap="round"
                                    strokeLinejoin="round"
                                    strokeWidth={2}
                                    d="M11 15l-3-3m0 0l3-3m-3 3h8M3 17h10a2 2 0 002-2v-6a2 2 0 00-2-2H3a2 2 0 00-2 2v6a2 2 0 002 2z"
                                />
                            </svg>
                        )}
                    </div>
                    <div>
                        <h3 className="text-lg font-semibold text-white">
                            {transaction.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}
                        </h3>
                        <p className="text-gray-400 text-sm">{transaction.category}</p>
                    </div>
                </div>
                <div className="text-right">
                    <h2
                        className={cn(
                            'text-xl font-bold',
                            transaction.type === 'income' ? 'text-green-400' : 'text-red-400',
                        )}
                    >
                        {formatCurrency(transaction.amount)}
                    </h2>
                    <p className="text-gray-400 text-sm">
                        {format(transaction.date, 'dd MMM yyyy')}
                    </p>
                </div>
            </div>
            <p className="text-gray-300 mt-2">{transaction.description}</p>
            <div className="mt-4 flex justify-end gap-2">
                <Button
                    variant="outline"
                    size="icon"
                    onClick={() => onEdit(transaction.id)}
                    className="bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 hover:text-blue-300"
                >
                    <Edit className="h-4 w-4" />
                </Button>
                <Button
                    variant="outline"
                    size="icon"
                    onClick={() => onDelete(transaction.id)}
                    className="bg-red-500/20 text-red-400 hover:bg-red-500/30 hover:text-red-300"
                >
                    <Trash2 className="h-4 w-4" />
                </Button>
            </div>
        </motion.div>
    );
};

const AddTransactionDialog = ({
    isOpen,
    onClose,
    onAdd,
    editingTransaction,
    onUpdate,
}: {
    isOpen: boolean;
    onClose: () => void;
    onAdd: (transaction: Omit<Transaction, 'id'>) => void;
    editingTransaction: Transaction | null;
    onUpdate: (id: string, transaction: Omit<Transaction, 'id'>) => void;
}) => {
    const [date, setDate] = useState<Date>(new Date());
    const [type, setType] = useState<'income' | 'expense'>('expense');
    const [category, setCategory] = useState<string>(CATEGORIES[0]);
    const [amount, setAmount] = useState<number>(0);
    const [description, setDescription] = useState<string>('');
    const [isSaving, setIsSaving] = useState(false); // State untuk loading saat menyimpan

    useEffect(() => {
        if (editingTransaction) {
            setDate(editingTransaction.date);
            setType(editingTransaction.type);
            setCategory(editingTransaction.category);
            setAmount(editingTransaction.amount);
            setDescription(editingTransaction.description);
        } else {
            // Reset form when adding a new transaction
            setDate(new Date());
            setType('expense');
            setCategory(CATEGORIES[0]);
            setAmount(0);
            setDescription('');
        }
    }, [editingTransaction]);

    const handleSave = async () => {
        setIsSaving(true); // Set loading state
        if (editingTransaction) {
            // Validasi input
            if (!date || !type || !category || !amount) {
                alert('Harap lengkapi semua field!'); // Gunakan dialog yang lebih baik
                setIsSaving(false);
                return;
            }
            const updatedTransaction: Omit<Transaction, 'id'> = {
                date,
                type,
                category,
                amount,
                description,
            };
            onUpdate(editingTransaction.id, updatedTransaction);
        } else {
            // Validasi input
            if (!date || !type || !category || !amount) {
                alert('Harap lengkapi semua field!'); // Gunakan dialog yang lebih baik
                setIsSaving(false);
                return;
            }
            const newTransaction: Omit<Transaction, 'id'> = {
                date,
                type,
                category,
                amount,
                description,
            };
            onAdd(newTransaction);
        }
        // Simulate async operation (e.g., Firebase call)
        // In a real app, you'd wait for the Firebase operation to complete
        setTimeout(() => {
            setIsSaving(false); // Reset loading state
            onClose();
        }, 500);
    };

    return (
        <Dialog open={isOpen} onOpenChange={onClose}>
            <DialogContent className="sm:max-w-[425px] bg-white/10 backdrop-blur-md border border-white/10">
                <DialogHeader>
                    <DialogTitle className="text-white">
                        {editingTransaction ? 'Edit Transaksi' : 'Tambah Transaksi'}
                    </DialogTitle>
                    <DialogDescription className="text-gray-400">
                        {editingTransaction
                            ? 'Ubah detail transaksi di bawah ini.'
                            : 'Masukkan detail transaksi baru.'}
                    </DialogDescription>
                </DialogHeader>
                <div className="grid gap-4 py-4">
                    <div className="grid grid-cols-4 items-center gap-4">
                        <label htmlFor="date" className="text-right text-white">
                            Tanggal
                        </label>
                        <Calendar
                            mode="single"
                            selected={date}
                            onSelect={setDate}
                            className="rounded-md border border-white/10"
                            style={{ backgroundColor: 'rgba(255, 255, 255, 0.05)' }} // Inline style for background
                        />
                        {/* <Input id="date" value={date.toLocaleDateString()} className="col-span-3" /> */}
                    </div>
                    <div className="grid grid-cols-4 items-center gap-4">
                        <label htmlFor="type" className="text-right text-white">
                            Jenis
                        </label>
                        <Select
                            onValueChange={(value) =>
                                setType(value as 'income' | 'expense')
                            }
                            defaultValue={type}
                        >
                            <SelectTrigger className="col-span-3 border border-white/10 bg-transparent text-white">
                                <SelectValue placeholder="Pilih jenis" />
                            </SelectTrigger>
                            <SelectContent className="bg-gray-800 border border-white/10">
                                <SelectItem value="income" className="hover:bg-white/10 text-white">Pemasukan</SelectItem>
                                <SelectItem value="expense" className="hover:bg-white/10 text-white">Pengeluaran</SelectItem>
                            </SelectContent>
                        </Select>
                    </div>
                    <div className="grid grid-cols-4 items-center gap-4">
                        <label htmlFor="category" className="text-right text-white">
                            Kategori
                        </label>
                        <Select
                            onValueChange={setCategory}
                            defaultValue={category}
                        >
                            <SelectTrigger className="col-span-3 border border-white/10 bg-transparent text-white">
                                <SelectValue placeholder="Pilih kategori" />
                            </SelectTrigger>
                            <SelectContent className="bg-gray-800 border border-white/10">
                                {CATEGORIES.map((cat) => (
                                    <SelectItem key={cat} value={cat} className="hover:bg-white/10 text-white">
                                        {cat}
                                    </SelectItem>
                                ))}
                            </SelectContent>
                        </Select>
                    </div>
                    <div className="grid grid-cols-4 items-center gap-4">
                        <label htmlFor="amount" className="text-right text-white">
                            Jumlah
                        </label>
                        <Input
                            id="amount"
                            type="number"
                            value={amount === 0 ? '' : amount}
                            onChange={(e) => setAmount(Number(e.target.value))}
                            className="col-span-3 border-white/10 bg-transparent text-white"
                            placeholder="0"
                        />
                    </div>
                    <div className="grid grid-cols-4 items-start gap-4">
                        <label htmlFor="description" className="text-right mt-2 text-white">
                            Deskripsi
                        </label>
                        <Textarea
                            id="description"
                            value={description}
                            onChange={(e) => setDescription(e.target.value)}
                            className="col-span-3 border-white/10 bg-transparent text-white"
                            placeholder="Masukkan deskripsi transaksi"
                        />
                    </div>
                </div>
                <DialogFooter>
                    <Button
                        variant="outline"
                        onClick={onClose}
                        className="bg-gray-500/20 text-gray-400 hover:bg-gray-500/30 hover:text-gray-300"
                        disabled={isSaving}
                    >
                        Batal
                    </Button>
                    <Button
                        type="submit"
                        onClick={handleSave}
                        className="bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 hover:text-blue-300 flex items-center gap-2"
                        disabled={isSaving}
                    >
                        {isSaving ? (
                            <>
                                <svg
                                    className="animate-spin h-5 w-5 text-white"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                >
                                    <circle
                                        className="opacity-25"
                                        cx="12"
                                        cy="12"
                                        r="10"
                                        stroke="currentColor"
                                        strokeWidth="4"
                                    ></circle>
                                    <path
                                        className="opacity-75"
                                        fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                                    ></path>
                                </svg>
                                Menyimpan...
                            </>
                        ) : (
                            <>
                                <Save className="h-4 w-4" />
                                Simpan
                            </>
                        )}
                    </Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    );
};

const FinancialTrackerApp = () => {
    const [transactions, setTransactions] = useState<Transaction[]>([]);
    const [selectedDate, setSelectedDate] = useState<Date>(new Date());
    const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);
    const [editingTransaction, setEditingTransaction] = useState<Transaction | null>(null);
    const [user, setUser] = useState<UserProfile | null>(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState<string | null>(null);

    // Fungsi untuk mendapatkan data transaksi dari Firebase
    const getTransactions = useCallback(async (uid: string) => {
        if (!db) {
            console.error('Firestore not initialized');
            setError('Firestore tidak terinisialisasi.');
            setLoading(false);
            return;
        }
        try {
            const transactionsRef = require("firebase/firestore").collection(db, 'users', uid, 'transactions');
            const q = require("firebase/firestore").query(transactionsRef, require("firebase/firestore").orderBy('date', 'desc'));
            const snapshot = await require("firebase/firestore").getDocs(q);
            const transactionsData: Transaction[] = snapshot.docs.map((doc) => {
                const data = doc.data();
                // Konversi Timestamp Firebase ke objek Date JavaScript
                const date = data.date ? (data.date instanceof Date ? data.date : data.date.toDate()) : new Date();
                return {
                    id: doc.id,
                    date: date,
                    type: data.type,
                    category: data.category,
                    amount: data.amount,
                    description: data.description,
                };
            });
            setTransactions(transactionsData);
        } catch (err: any) {
            setError(err.message || 'Gagal mengambil data transaksi.');
        } finally {
            setLoading(false);
        }
    }, [db]);

    // Fungsi untuk menambahkan transaksi ke Firebase
    const addTransaction = useCallback(
        async (transaction: Omit<Transaction, 'id'>) => {
            if (!user) {
                console.error('User not logged in');
                setError('Pengguna belum login.');
                return;
            }
            if (!db) {
                console.error('Firestore not initialized');
                setError('Firestore tidak terinisialisasi.');
                return;
            }
            try {
                const transactionsRef = require("firebase/firestore").collection(db, 'users', user.uid, 'transactions');
                // Simpan tanggal sebagai Timestamp
                const docRef = await require("firebase/firestore").addDoc(transactionsRef, {
                    ...transaction,
                    date: transaction.date, // Simpan sebagai Date object
                });
                const newTransaction = { id: docRef.id, ...transaction, date: transaction.date };
                setTransactions((prevTransactions) => [newTransaction, ...prevTransactions]);
            } catch (err: any) {
                setError(err.message || 'Gagal menambahkan transaksi.');
            }
        },
        [db, user],
    );

    // Fungsi untuk mengupdate transaksi di Firebase
    const updateTransaction = useCallback(
        async (id: string, updatedTransaction: Omit<Transaction, 'id'>) => {
            if (!user) {
                console.error('User not logged in');
                setError('Pengguna belum login.');
                return;
            }
            if (!db) {
                console.error('Firestore not initialized');
                setError('Firestore tidak terinisialisasi.');
                return;
            }
            try {
                const transactionRef = require("firebase/firestore").doc(db, 'users', user.uid, 'transactions', id);
                // Update tanggal sebagai Timestamp
                await require("firebase/firestore").updateDoc(transactionRef, {
                    ...updatedTransaction,
                    date: updatedTransaction.date, // Simpan sebagai Date
                });

                setTransactions((prevTransactions) =>
                    prevTransactions.map((transaction) =>
                        transaction.id === id
                            ? { id, ...updatedTransaction, date: updatedTransaction.date }
                            : transaction,
                    ),
                );
                setEditingTransaction(null); // Reset editing state
            } catch (err: any) {
                setError(err.message || 'Gagal mengupdate transaksi.');
            }
        },
        [db, user],
    );

    // Fungsi untuk menghapus transaksi dari Firebase
    const deleteTransaction = useCallback(
        async (id: string) => {
            if (!user) {
                console.error('User not logged in');
                setError('Pengguna belum login.');
                return;
            }
            if (!db) {
                console.error('Firestore not initialized');
                setError('Firestore tidak terinisialisasi.');
                return;
            }
            try {
                const transactionRef = require("firebase/firestore").doc(db, 'users', user.uid, 'transactions', id);
                await require("firebase/firestore").deleteDoc(transactionRef);
                setTransactions((prevTransactions) =>
                    prevTransactions.filter((transaction) => transaction.id !== id),
                );
            } catch (err: any) {
                setError(err.message || 'Gagal menghapus transaksi.');
            }
        },
        [db, user],
    );

    // Fungsi untuk menghitung total pemasukan dan pengeluaran
    const calculateSummary = (transactions: Transaction[]) => {
        let income = 0;
        let expense = 0;
        transactions.forEach((transaction) => {
            if (transaction.type === 'income') {
                income += transaction.amount;
            } else {
                expense += transaction.amount;
            }
        });
        return { income, expense };
    };

    // Filter transaksi berdasarkan bulan yang dipilih
    const filteredTransactions = transactions.filter(
        (transaction) =>
            format(transaction.date, 'yyyy-MM') === format(selectedDate, 'yyyy-MM'),
    );

    const { income, expense } = calculateSummary(filteredTransactions);

    // Fungsi untuk menangani login dengan Google
    const signInWithGoogle = async () => {
        if (!auth) {
            console.error('Authentication not initialized');
            setError('Autentikasi tidak terinisialisasi.');
            return;
        }
        const provider = new require("firebase/auth").GoogleAuthProvider();
        try {
            const result = await require("firebase/auth").signInWithPopup(auth, provider);
            const user = result.user;
            setUser({
                uid: user.uid,
                email: user.email || '',
                displayName: user.displayName || 'Pengguna',
            });

            // Cek apakah user ada di database
            const userRef = require("firebase/firestore").doc(db, "users", user.uid);
            const docSnap = await require("firebase/firestore").getDoc(userRef);
            if (!docSnap.exists()) {
                // Jika tidak, tambahkan data user ke database
                await require("firebase/firestore").setDoc(userRef, {
                    email: user.email,
                    displayName: user.displayName,
                });
            }

            // Setelah login berhasil, ambil data transaksi
            await getTransactions(user.uid);
        } catch (error: any) {
            setError(error.message || 'Gagal login.');
        }
    };

    // Fungsi untuk menangani logout
    const signOut = async () => {
        if (!auth) {
            console.error('Authentication not initialized');
            setError('Autentikasi tidak terinisialisasi.');
            return;
        }
        try {
            await require("firebase/auth").signOut(auth);
            setUser(null);
            setTransactions([]); // Clear transactions on logout
        } catch (error: any) {
            setError(error.message || 'Gagal logout.');
        }
    };

    // Efek untuk memantau perubahan otentikasi
    useEffect(() => {
        if (!auth) return;

        const unsubscribe = require("firebase/auth").onAuthStateChanged(auth, async (user) => {
            if (user) {
                setUser({
                    uid: user.uid,
                    email: user.email || '',
                    displayName: user.displayName || 'Pengguna',
                });
                // Ambil data transaksi setelah login
                await getTransactions(user.uid);
            } else {
                setUser(null);
                setLoading(false); // Set loading false when logged out
            }
        }, (error) => {
            setError(error.message || 'Gagal memantau status login.');
            setLoading(false);
        });

        return () => unsubscribe();
    }, [auth, getTransactions]);

    // Efek untuk mengambil data transaksi saat komponen di-mount dan saat user berubah
    useEffect(() => {
        if (user) {
            setLoading(true); // Set loading true before fetching
            getTransactions(user.uid);
        }
    }, [getTransactions, user]);

    const handleEditTransaction = (id: string) => {
        const transactionToEdit = transactions.find((t) => t.id === id);
        if (transactionToEdit) {
            setEditingTransaction(transactionToEdit);
            setIsAddDialogOpen(true);
        }
    };

    return (
        <div className="min-h-screen bg-gray-900 text-gray-100 p-4">
            <div className="container mx-auto">
                <div className="flex justify-between items-center mb-8">
                    <h1 className="text-3xl font-bold">Aplikasi Pencatatan Keuangan</h1>
                    {user ? (
                        <div className="flex items-center gap-4">
                            <span className="flex items-center gap-2">
                                <User className="w-4 h-4 text-gray-400" />
                                <span className="text-gray-300">{user.displayName}</span>
                            </span>
                            <Button
                                onClick={signOut}
                                className="bg-red-500/20 text-red-400 hover:bg-red-500/30 hover:text-red-300 flex items-center gap-2"
                            >
                                <LogOut className="w-4 h-4" />
                                Logout
                            </Button>
                        </div>
                    ) : (
                        <Button
                            onClick={signInWithGoogle}
                            className="bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 hover:text-blue-300 flex items-center gap-2"
                        >
                            <svg
                                className="w-4 h-4"
                                aria-hidden="true"
                                focusable="false"
                                data-prefix="fab"
                                data-icon="google"
                                role="img"
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 488 488"
                            >
                                <path
                                    fill="currentColor"
                                    d="M488 148.4c-25.6-5.6-53-9.8-82.7-9.8-73.5 0-133.1 59.7-133.1 133.2 0 73.5 59.6 133.2 133.1 133.2 28.2 0 54.4-8.7 75.9-23.8l-26-68.7c-21.9 14.9-49.5 24.5-79.9 24.5-49.2 0-89.3-38.1-89.3-85.6 0-47.5 40.1-85.6 89.3-85.6 41.5 0 76.2 29.6 79.7 70.6h-197.6v56.5h299c-6.1-58.4-39.3-96.2-89.5-96.2-51.6 0-97.5 41.9-97.5 93.1 0 51.4 45.9 93.1 97.5 93.1 52.5 0 90.3-34.1 94.3-81.4z"
                                />
                            </svg>
                            Login dengan Google
                        </Button>
                    )}
                </div>

                {loading ? (
                    <div className="text-center text-gray-400">Loading...</div> // Tampilkan pesan loading
                ) : error ? (
                    <div className="text-center text-red-500">Error: {error}</div> // Tampilkan pesan error
                ) : !user ? (
                    <div className="text-center text-gray-400">Silakan login untuk melanjutkan.</div>
                ) : (
                    <>
                        <div className="flex flex-col md:flex-row gap-8">
                            <div className="md:w-1/3">
                                <Card className="bg-white/5 backdrop-blur-md border border-white/10">
                                    <CardHeader>
                                        <CardTitle className="text-white">Ringkasan</CardTitle>
                                        <CardDescription className="text-gray-400">
                                            Total Pemasukan dan Pengeluaran
                                        </CardDescription>
                                    </CardHeader>
                                    <CardContent>
                                        <div className="mb-4">
                                            <h3 className="text-lg font-semibold text-green-400">Pemasukan</h3>
                                            <p className="text-xl font-bold text-white">
                                                {formatCurrency(income)}
                                            </p>
                                        </div>
                                        <div>
                                            <h3 className="text-lg font-semibold text-red-400">Pengeluaran</h3>
                                            <p className="text-xl font-bold text-white">
                                                {formatCurrency(expense)}
                                            </p>
                                        </div>
                                        <div className="mt-6">
                                            <h3 className="text-lg font-semibold text-white">
                                                Saldo
                                            </h3>
                                            <p className="text-2xl font-bold text-blue-400">
                                                {formatCurrency(income - expense)}
                                            </p>
                                        </div>
                                    </CardContent>
                                    <CardFooter>
                                        <div className="flex items-center gap-2">
                                            <CalendarIcon className="w-4 h-4 text-gray-400" />
                                            <div className="flex items-center gap-2">
                                                <Button
                                                    variant="outline"
                                                    size="icon"
                                                    onClick={() => setSelectedDate(subMonths(selectedDate, 1))}
                                                    className="bg-gray-700/50 text-gray-400 hover:bg-gray-700 hover:text-gray-300"
                                                >
                                                    <svg
                                                        xmlns="http://www.w3.org/2000/svg"
                                                        className="h-4 w-4"
                                                        fill="none"
                                                        viewBox="0 0 24 24"
                                                        stroke="currentColor"
                                                    >
                                                        <path
                                                            strokeLinecap="round"
                                                            strokeLinejoin="round"
                                                            strokeWidth={2}
                                                            d="M15 19l-7-7 7-7"
                                                        />
                                                    </svg>
                                                </Button>
                                                <span className="text-gray-300">
                                                    {getMonthName(selectedDate)} {selectedDate.getFullYear()}
                                                </span>
                                                <Button
                                                    variant="outline"
                                                    size="icon"
                                                    onClick={() => setSelectedDate(addMonths(selectedDate, 1))}
                                                    className="bg-gray-700/50 text-gray-400 hover:bg-gray-700 hover:text-gray-300"
                                                >
                                                    <svg
                                                        xmlns="http://www.w3.org/2000/svg"
                                                        className="h-4 w-4"
                                                        fill="none"
                                                        viewBox="0 0 24 24"
                                                        stroke="currentColor"
                                                    >
                                                        <path
                                                            strokeLinecap="round"
                                                            strokeLinejoin="round"
                                                            strokeWidth={2}
                                                            d="M9 5l7 7-7 7"
                                                        />
                                                    </svg>
                                                </Button>
                                            </div>
                                        </div>
                                    </CardFooter>
                                </Card>
                            </div>
                            <div className="md:w-2/3">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-semibold text-white">Transaksi</h2>
                                    <Button
                                        onClick={() => setIsAddDialogOpen(true)}
                                        className="bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 hover:text-blue-300 flex items-center gap-2"
                                    >
                                        <Plus className="h-4 w-4" />
                                        Tambah Transaksi
                                    </Button>
                                </div>
                                <AnimatePresence>
                                    {filteredTransactions.length > 0 ? (
                                        filteredTransactions.map((transaction) => (
                                            <TransactionCard
                                                key={transaction.id}
                                                transaction={transaction}
                                                onDelete={deleteTransaction}
                                                onEdit={handleEditTransaction}
                                            />
                                        ))
                                    ) : (
                                        <div className="bg-white/5 backdrop-blur-md rounded-lg p-4 shadow-md border border-white/10 text-center">
                                            Tidak ada transaksi untuk bulan ini.
                                        </div>
                                    )}
                                </AnimatePresence>
                            </div>
                        </div>
                        <AddTransactionDialog
                            isOpen={isAddDialogOpen}
                            onClose={() => {
                                setIsAddDialogOpen(false);
                                setEditingTransaction(null);
                            }}
                            onAdd={addTransaction}
                            editingTransaction={editingTransaction}
                            onUpdate={updateTransaction}
                        />
                    </>
                )}
            </div>
        </div>
    );
};

export default FinancialTrackerApp;
